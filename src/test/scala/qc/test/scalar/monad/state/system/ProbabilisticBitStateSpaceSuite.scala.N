package qc.test.scalar.computation.state.system

import math.types.scalar.{Real}

import qc.types.system.{Bit}

import math.examples.columnVectors.{probabilisticBitStateSpace}

import probabilisticBitStateSpace.{
  Σ,
  columnVector,
  kets,
  braKet,
  linearBraKetCombination,
  observeState,
  observeStateTwice
}

class ProbabilisticBitStateSpaceSuite extends munit.FunSuite:

  import math.examples.columnVectors.{
    realColumnVector => probabilisticBitStateColumnVector
  }

  test("probabilisticBitStateSpace.kets forall { ket => ket.norm == 1.0 }"):
    assert(
      kets forall { ket => ket.norm == 1.0 },
      true
    )

  extension (lx: Bit) def δ(rx: Bit): Real = probabilisticBitStateSpace.δ(lx)(rx)
  test("Σ forall { lx => Σ forall { rx => (lx braKet rx) == (lx δ rx) } }"):
    assert(
      Σ forall { lx => Σ forall { rx => (lx braKet rx) == (lx δ rx) } },
      true
    )

  test(
    "probabilisticBitStateColumnVector.seq == linearBraKetCombination(probabilisticBitStateColumnVector).seq"
  ):
    assert(
      probabilisticBitStateColumnVector.seq ==
        linearBraKetCombination(probabilisticBitStateColumnVector).seq,
      true
    )

  test(
    "observeState(probabilisticBitStateColumnVector) == observeStateTwice(probabilisticBitStateColumnVector)"
  ):
    assert(
      observeState(probabilisticBitStateColumnVector) ==
        observeStateTwice(probabilisticBitStateColumnVector),
      true
    )
